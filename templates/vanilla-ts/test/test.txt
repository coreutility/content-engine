<template>
  <div>
    <!--NuxtRouteAnnouncer /-->
    <!--NuxtWelcome /-->
  </div>


  <!--test-->
  <!--div>
    <div>==Log==</div>
    <div>
      {{ JSON.stringify(_data) }}
    </div>
  </div-->
  <div>
    <div>==Preview==</div>
    <div v-html="_html"></div>
  </div>
  <div >
    <ClientOnly>
    <div>==Editor==</div>
    <div  v-html="_editor_html"></div>
    </ClientOnly>
  </div>


</template>

<script lang="ts" setup>
import { ce_renderer, ce_hydrator, ce_editor } from './utils/content_engine';


//test..
//console.log(`--`);
const _html = ref(``);
const _css_server = ref(``);
const _css_client = ref(``);
//set..
const _editor_html = ref(``);
const _editor_css_client = ref(``);
const _data = ref({
    l: []/*[

      {
        "id": "3e1bc78c-104f-4f6f-aa87-ee295db8ad8b",
        "type": "table",
        "data": {
          sortBy: 'id',
          sortDirection: 'asc',
          columns: [
            { key: 'id', title: 'ID', type: 'number', sortable: true },
            { key: 'name', title: 'Name', type: 'text', sortable: true },
            { key: 'age', title: 'Age', type: 'number', sortable: true },
            { key: 'email', title: 'Email', type: 'text', sortable: false },
            { key: 'active', title: 'Active', type: 'boolean', sortable: true },
            { key: 'joinDate', title: 'Join Date', type: 'date', sortable: true }
          ],
          rows: [
            {
              id: '1',
              name: 'John Doe',
              age: 28,
              email: 'john.doe@example.com',
              active: true,
              joinDate: '2023-01-15'
            },
            {
              id: 2,
              name: 'Jane Smith',
              age: 32,
              email: 'jane.smith@example.com',
              active: false,
              joinDate: '2022-11-20'
            },
          ]
        }
      },
      {
        "id": "3e1bc78c-104f-4f6f-aa87-ee295db8ad8c",
        "type": "text",
        "data": {
          "data": "Hello world! </br> ",
        },
      }

    ]*/
});
const _ce_renderer = await ce_renderer({});
const _ce_hydrator = await ce_hydrator({});
const _ce_editor = await ce_editor({});

watch(_data, async (_new, _old) => {
//console.log(`changed from ${_new} to ${_old}`);

//set..
if (import.meta.client) { // import.meta.server |  import.meta.client  //NOTE: For real world where, we need SSR in action we use "import.meta.server". 
const _ce_renderer_rsp =  await _ce_renderer.set({
  data:_data
});
//console.log(_ce_renderer_rsp.r);

//set..
_html.value = _ce_renderer_rsp.r;
_css_server.value = _ce_renderer_rsp.style;




}
if (import.meta.client) {
const _ce_hydrator_rsp =  await _ce_hydrator.set({
  data:_data
});

//set..
_css_client.value = _ce_hydrator_rsp.style;
}


}, {deep:true});




//====Editor====//  [START]
if (import.meta.client) {
  const _ce_editor_rsp =  await _ce_editor.set({
    data:{
      l:[]
    }
  },{
    change: (_v) => {
      console.log(`--ce:editor [change]`);
      //console.log(_v._$p.data[`curr`]);

      //test..
      _data.value.l = _v._$p.data[`curr`].data.l;
      console.log(_data.value.l);
      
    },
  });

  //set..
  _editor_html.value = _ce_editor_rsp.r;
  _editor_css_client.value = _ce_editor_rsp.style;

}
//====Editor====//  [END]





//set..
useHead({
  style: [{
    innerHTML: _css_server,
  },{
    innerHTML: _css_client,
  },{
    innerHTML: _editor_css_client,
  }]
});

 


</script>