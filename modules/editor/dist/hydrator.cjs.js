"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ee=async()=>({set:async b=>{const w={data:{l:[]}},a="https://cdn.jsdelivr.net/gh/coreutility/content-engine/modules-list.json";try{const c=await(await fetch(a)).json();w.data.l=c}catch{console.error(`Err: Unable to load modules-list from [url=${a}]`)}return w}}),Y=async b=>({set:async w=>{console.log(`--hydrator [${w.data.curr.type}]`);const a={data:{l:[],get_all:()=>JSON.parse(JSON.stringify(a.data.l)),sync:()=>{const c=a.data.get_all();w.data.curr.data={l:c},b.f.call("msg",{type:"change",_p:b,_$p:w,custom:{}})},upsert:c=>{const r=JSON.parse(JSON.stringify(c.val._$p.data.curr)),u=a.data.l.findIndex(y=>y.id==r.id);u>-1?a.data.l[u]=r:a.data.l.push(r),a.data.sync()},remove:c=>{const r=JSON.parse(JSON.stringify(c.val._$p.data.curr)),u=a.data.l.findIndex(y=>y.id==r.id);u>-1&&a.data.l.splice(u,1),a.data.sync()},change_index:c=>{const r=JSON.parse(JSON.stringify(c.val._$p.data.curr)),{id:u}=r,y=c.newIdx,E=a.data.l.findIndex(g=>g.id==u);if(E>-1&&y>=0&&y<a.data.l.length){const[g]=a.data.l.splice(E,1);a.data.l.splice(y,0,g)}a.data.sync()}}},O={r:"",style:""};return(async()=>{const c=document.getElementById("editor"),r=document.getElementById("emptyState"),u=document.getElementById("commandMenu"),y=document.getElementById("commandSearch"),E=document.getElementById("commandOptions"),g=document.getElementById("blockMenu");await(async()=>{const e=await(await ee()).set({});let t="";for(const n of e.data.l)t+=`
                    <div class="command-option" data-type="${n.name}">
                        <div class="command-icon">${n.icon}</div>
                        <div class="command-label">
                            <div>${n.title}</div>
                            <div class="command-description">${n.description}</div>
                        </div>
                    </div>
                    `;E.innerHTML=t})();const S=E.querySelectorAll(".command-option");let i=null,x=!1,C=!1,f=0,B=null,k=null,T=!1,A=null;L("text"),document.addEventListener("keydown",function(e){e.key==="/"&&!x&&!C?(D("slash"),e.preventDefault()):e.key==="Escape"?(M(),$()):x?K(e):e.key==="Enter"&&!e.shiftKey?P(e):e.key==="Backspace"&&i?U(e):e.key==="ArrowUp"&&i?W(e):e.key==="ArrowDown"&&i?X(e):e.key==="Tab"&&i&&j(e)}),y.addEventListener("input",function(){I(this.value)}),document.addEventListener("click",function(e){!u.contains(e.target)&&x&&M(),!g.contains(e.target)&&C&&$()}),S.forEach(e=>{e.addEventListener("click",function(){const t=this.getAttribute("data-type");N(t),M()})});async function L(e,t="",n=null){v(),r.classList.contains("visible")&&r.classList.remove("visible");const o=document.createElement("div");o.className=`block ${e}`,o.draggable=!0;const s=document.createElement("div");s.className="block-controls";const p=document.createElement("div");p.className="block-control block-handle",p.innerHTML="⋮⋮",p.addEventListener("click",function(d){d.stopPropagation(),J(o)});const h=document.createElement("div");h.className="block-control block-plus",h.innerHTML="+",h.addEventListener("click",function(d){d.stopPropagation(),D("plus",o)}),s.appendChild(p),s.appendChild(h),o.appendChild(s);const l=document.createElement("div");l.className="block-content",l.setAttribute("data-placeholder","Type '/' for commands..."),t&&(l.innerHTML=t);const z=await(await b.f.get_lib({name:`${e}`,run_from:"editor"})).lib,R=b.f.new_emitter();let G={my:{},f:{...b.f,call:R.emit}},Q={data:{}};(async()=>R.on("msg",async d=>{d.type=="change"&&a.data.upsert({val:d})}))();const Z=await(await z.editor(G)).set(Q);if(l.innerHTML=`${Z.r}`,o.appendChild(l),H(o),e!=="divider"&&e!=="image"){const d=e==="toggle-list"?l.querySelector(".toggle-summary"):l;d.addEventListener("focus",function(){m(o)}),d.addEventListener("input",function(){v()}),d.addEventListener("keydown",function(_){_.key==="/"&&(D("slash"),_.preventDefault())})}if(o.addEventListener("click",function(d){if(!d.target.closest(".block-controls")){m(o);const _=e==="toggle-list"?l.querySelector(".toggle-summary"):l;_&&_.focus()}}),n?c?.insertBefore(o,n.nextSibling):c?.appendChild(o),o.style.opacity="0",o.style.transform="translateY(10px)",setTimeout(()=>{o.style.transition="all 0.2s ease",o.style.opacity="1",o.style.transform="translateY(0)"},10),e!=="divider"&&e!=="image"){const d=e==="toggle-list"?l.querySelector(".toggle-summary"):l;d&&!n&&setTimeout(()=>d.focus(),100)}return n||m(o),v(),o}function v(){const e=c.querySelectorAll(".block"),t=e.length>0,n=Array.from(e).some(o=>{const s=o.querySelector('[contenteditable="true"]');return s&&s.textContent.trim()!==""});!t||!n?(r.classList.add("visible"),i=null):r.classList.remove("visible")}function H(e){e.addEventListener("dragstart",function(t){k=this,T=!0,this.classList.add("dragging"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",this.innerHTML);const n=this.cloneNode(!0);n.style.width=this.offsetWidth+"px",n.style.opacity="0.8",document.body.appendChild(n),t.dataTransfer.setDragImage(n,20,10),setTimeout(()=>document.body.removeChild(n),0)}),e.addEventListener("dragend",function(){T=!1,this.classList.remove("dragging"),document.querySelectorAll(".block").forEach(t=>{t.classList.remove("drag-over")}),v()}),e.addEventListener("dragover",function(t){T&&k!==this&&(t.preventDefault(),this.classList.add("drag-over"))}),e.addEventListener("dragenter",function(t){T&&k!==this&&t.preventDefault()}),e.addEventListener("dragleave",function(){this.classList.remove("drag-over")}),e.addEventListener("drop",function(t){t.preventDefault(),k!==this&&(this.classList.remove("drag-over"),c.insertBefore(k,this),m(k),v())})}function m(e){i&&i.classList.remove("focused"),i=e,e&&e.classList.add("focused")}function D(e,t=null){if(e==="slash"&&r?.classList.contains("visible"))return;B=e,A=t;let n;if(e==="slash"){if(n=V(),n.width===0&&n.height===0)if(i){const l=i.getBoundingClientRect();n={top:l.top+l.height,left:l.left,width:0,height:0}}else{const l=r.getBoundingClientRect();n={top:l.top+l.height,left:l.left,width:0,height:0}}}else n=t.querySelector(".block-plus").getBoundingClientRect();const o=u.getBoundingClientRect(),s=window.innerHeight;let p=n.top+window.scrollY+10,h=n.left+window.scrollX;p+o.height>s+window.scrollY&&(p=n.top+window.scrollY-o.height-10),h+o.width>window.innerWidth+window.scrollX&&(h=window.innerWidth+window.scrollX-o.width-20),u.style.top=`${p}px`,u.style.left=`${h}px`,u.classList.add("visible"),x=!0,y.value="",I(""),f=0,q(),setTimeout(()=>y.focus(),50)}function M(){u.classList.remove("visible"),x=!1,B=null,A=null}function J(e){const t=e.getBoundingClientRect(),n=g.getBoundingClientRect(),o=window.innerHeight;let s=t.top+window.scrollY+30,p=t.left+window.scrollX;s+n.height>o+window.scrollY&&(s=t.top+window.scrollY-n.height-10),g.style.top=`${s}px`,g.style.left=`${p}px`,g.classList.add("visible"),C=!0,m(e)}function $(){g.classList.remove("visible"),C=!1}function I(e){const t=Array.from(S);let n=0;t.forEach((o,s)=>{const p=o.querySelector(".command-label div:first-child").textContent.toLowerCase(),h=o.querySelector(".command-description").textContent.toLowerCase(),l=e.toLowerCase();p.includes(l)||h.includes(l)||e===""?(o.style.display="flex",n++,n===1&&(f=s)):o.style.display="none"}),q()}function K(e){const t=Array.from(S).filter(n=>n.style.display!=="none");switch(e.key){case"ArrowUp":f=f>0?f-1:t.length-1,q(),e.preventDefault();break;case"ArrowDown":f=f<t.length-1?f+1:0,q(),e.preventDefault();break;case"Enter":if(t[f]){const n=t[f].getAttribute("data-type");N(n),M()}e.preventDefault();break}}function q(){const e=Array.from(S).filter(t=>t.style.display!=="none");S.forEach(t=>{t.classList.remove("selected")}),e[f]&&(e[f].classList.add("selected"),e[f].scrollIntoView({block:"nearest",behavior:"smooth"}))}async function N(e){if(B==="slash"){const t=i.querySelector('[contenteditable="true"]')?.textContent.replace("/","")||"",n=await L(e,t);i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.remove(),v()},150),m(n),setTimeout(()=>{const o=n.querySelector('[contenteditable="true"]');o&&o.focus()},160)}else if(B==="plus"&&A){const t=await L(e,"",A);m(t),setTimeout(()=>{const n=t.querySelector('[contenteditable="true"]');n&&n.focus()},100)}}async function P(e){if(!i)return;e.preventDefault();const t=Array.from(i.classList).find(s=>s.startsWith("heading-")||s==="text"||s==="bullet-list"||s==="numbered-list"||s==="quote"||s==="code");let n="text";(t==="bullet-list"||t==="numbered-list")&&(n=t);const o=await L(n,"",i);m(o)}function j(e){i&&e.preventDefault()}function U(e){if(!i)return;const t=i.querySelector('[contenteditable="true"]');if(t&&t.textContent===""&&c.querySelectorAll(".block").length>1){e.preventDefault();const n=i.previousElementSibling;i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{if(i.remove(),n&&n.classList.contains("block")){m(n);const o=n.querySelector('[contenteditable="true"]');o&&o.focus()}v()},150)}else t&&t.textContent===""&&c.querySelectorAll(".block").length===1&&(e.preventDefault(),i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.remove(),i=null,v()},150))}function W(e){if(!i||e.shiftKey)return;const t=i.previousElementSibling;if(t&&t.classList.contains("block")){e.preventDefault(),m(t);const n=t.querySelector('[contenteditable="true"]');n&&n.focus()}}function X(e){if(!i||e.shiftKey)return;const t=i.nextElementSibling;if(t&&t.classList.contains("block")){e.preventDefault(),m(t);const n=t.querySelector('[contenteditable="true"]');n&&n.focus()}}function V(){const e=window.getSelection();return e.rangeCount===0?{top:0,left:0,width:0,height:0}:e.getRangeAt(0).getBoundingClientRect()}g.querySelectorAll(".block-menu-option").forEach(e=>{e.addEventListener("click",async function(){const t=this.getAttribute("data-action");await F(t),$()})});async function F(e){if(i)switch(e){case"delete":const t=i.previousElementSibling;i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{if(i.remove(),t&&t.classList.contains("block")){m(t);const s=t.querySelector('[contenteditable="true"]');s&&s.focus()}v()},150);break;case"duplicate":const n=i.querySelector('[contenteditable="true"]')?.innerHTML||"",o=Array.from(i.classList).find(s=>s!=="block"&&s!=="focused");await L(o,n,i);break;case"turn-into":D("slash");break}}r.addEventListener("click",async function(){r.classList.contains("visible")&&await L("text")}),document.addEventListener("mousedown",function(){document.body.classList.add("using-mouse")}),document.addEventListener("keydown",function(){document.body.classList.remove("using-mouse")})})(),O}});exports.hydrator=Y;exports.index=Y;
